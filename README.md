# æ­å»º pnpm + changesets é¡¹ç›®æ¨¡æ¿å®è·µ

## å‰è¨€

éšç€ä¸šåŠ¡å¤æ‚åº¦çš„ç›´çº¿æå‡ï¼Œå‰ç«¯é¡¹ç›®ä¸ç®¡æ˜¯ä»ä»£ç é‡ä¸Šï¼Œè¿˜æ˜¯ä»ä¾èµ–å…³ç³»ä¸Šéƒ½å‘ˆçˆ†ç‚¸å¼å¢é•¿ã€‚åŒæ—¶ï¼Œç”±äºå›¢é˜Ÿä¸­ä¸æ­¢æœ‰ä¸€ä¸ªä¸šåŠ¡é¡¹ç›®ï¼Œæ‰€ä»¥â€œå¤šä¸ªé¡¹ç›®ä¹‹é—´å¦‚ä½•é…åˆâ€
â€œå¦‚ä½•ç»´æŠ¤ç›¸äº’å…³ç³»â€ â€œå…¬å¸è‡ªå·±çš„å…¬å…±åº“ç‰ˆæœ¬å¦‚ä½•ç®¡ç†â€ è¿™äº›é—®é¢˜éšç€ä¸šåŠ¡æ‰©å±•çº·çº·æµ®å‡ºæ°´é¢ã€‚

é‰´äºä¸Šè¿°ç§ç§é—®é¢˜ï¼Œä¸šç•Œä¹Ÿæœ‰ä¸€äº›æœ€ä½³å®è·µï¼ŒåŸºäºpnpm + changesetsçš„æ–¹å¼å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œæ¥ä¸‹æ¥ä¼šå¯¹è¿™äº›å·¥å…·çš„æ¦‚å¿µä»¥åŠåŸºæœ¬ä½¿ç”¨è¿›è¡Œä»‹ç»ã€‚

## monorepo å’Œ multirepo

multirepoï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‰ç…§åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼Œä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªä»“åº“ï¼Œå…¸å‹æ¡ˆä¾‹å°±æ˜¯å…¬å¸ä¸­å°ä¸šåŠ¡æ¨¡å—å‰ç«¯é¡¹ç›®å°±æ˜¯æŒ‰ç…§multirepoçš„æ–¹å¼è¿›è¡Œç®¡ç†ï¼›è€Œmonorepo
å°±æ˜¯å°†åº”ç”¨çš„æ‰€æœ‰æ¨¡å—ä¸€è‚¡è„‘å…¨æ”¾åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œä¸éœ€è¦å•ç‹¬å‘åŒ…ï¼Œæµ‹è¯•ï¼Œä¸”æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ç®¡ç†ï¼Œä¸€åŒéƒ¨ç½²ä¸Šçº¿ï¼Œèƒ½å¤Ÿåœ¨
å¼€å‘é˜¶æ®µæ›´æ—©çš„å¤ç°bugï¼Œæš´éœ²é—®é¢˜ã€‚

multirepoå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- å¼€å‘è°ƒè¯•åŠç‰ˆæœ¬æ›´æ–°æ•ˆç‡ä½ä¸‹ã€‚
- å›¢é˜ŸæŠ€æœ¯é€‰å‹åˆ†æ’’ï¼Œä¸åŒåº“çš„å®ç°é£æ ¼å¯èƒ½å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼ˆæ¯”å¦‚æœ‰çš„åº“ä¾èµ–Vueï¼Œæœ‰çš„åº“ä¾èµ–Reactï¼‰ã€‚
- changelog æ¢³ç†å›°éš¾ï¼ŒIssues ç®¡ç†æ··ä¹±ï¼ˆå¯¹åº”å¼€æºåº“æ¥è¯´ï¼‰ã€‚

è€Œ monorepo ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œå…·ä½“å¦‚ä¸‹ã€‚

- åº“ä½“ç§¯è¶…å¤§ï¼Œç›®å½•ç»“æ„å¤æ‚åº¦ä¸Šå‡ã€‚
- éœ€è¦ä½¿ç”¨ç»´æŠ¤ monorepo çš„å·¥å…·ï¼Œè¿™å°±æ„å‘³ç€å­¦ä¹ æˆæœ¬æ¯”è¾ƒé«˜ã€‚
- å¯¹äºç®¡ç†è€…æ¥è¯´, æ— æ³•è¿›è¡Œç²¾å‡†çš„æƒé™æ§åˆ¶ï¼ˆè¿™ä¸ªåº”è¯¥æœ‰æ–¹æ¡ˆï¼‰

## ä»€ä¹ˆæ˜¯pnpmï¼Ÿå®ƒæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ

pnpm å…¨ç§°æ˜¯ â€œPerformant NPMâ€ï¼Œå³é«˜æ€§èƒ½çš„ npmã€‚

å®ƒçš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹:

- èƒ½å¤Ÿå¤§å¤§èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä¸åŒäºnpmï¼ŒåŒä¸€ä¸ªä¾èµ–è¢«ä¸åŒçš„é¡¹ç›®ä½¿ç”¨æ—¶ï¼Œéƒ½ä¼šè¢«é‡å¤å®‰è£…ä¸€æ¬¡ï¼Œè€Œpnpmåˆ™ä¼šå°†ä¾èµ–æŒ‰ç‰ˆæœ¬è¿›è¡Œå­˜å‚¨ï¼Œå¦‚æœåœ¨å­˜å‚¨ä¸­å¿ƒèƒ½å¤Ÿæ‰¾åˆ°æ­¤ä¾èµ–ï¼Œ
  åˆ™ä¼šå°†åŒ…é‡Œçš„æ–‡ä»¶ç¡¬é“¾æ¥åˆ°å­˜å‚¨ä¸­å¿ƒä¸­å¯¹åº”ä¾èµ–çš„ä½ç½®ï¼Œä¸ä¼šé‡å¤å®‰è£…ã€‚
- å¤§å¤§æé«˜äº†å®‰è£…é€Ÿåº¦ï¼Œä¹‹å‰å®‰è£…è¿‡çš„ä¾èµ–éƒ½ä¼šç›´æ¥ä»å­˜å‚¨ä¸­å¿ƒä¸­è·å–å¹¶é“¾æ¥åˆ°é¡¹ç›®çš„node_modulesä¸­ã€‚
- é¿å…å‡ºç°å¹½çµä¾èµ–çš„é—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œpnpm ä½¿ç”¨ç¬¦å·é“¾æ¥å°†é¡¹ç›®çš„ç›´æ¥ä¾èµ–é¡¹æ·»åŠ åˆ°æ¨¡å—ç›®å½•çš„æ ¹ç›®å½•ä¸­ï¼Œè€Œå¯¹åº”çš„åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åªå¯ä»¥è®¿é—®package.json
  æ–‡ä»¶ä¸­å£°æ˜è¿‡çš„ä¾èµ–é¡¹ï¼Œæ— æ³•è®¿é—®æœªå£°æ˜çš„çš„ä¾èµ–é¡¹ï¼Œæƒ³äº†è§£æ›´å¤šå¯ä»¥ç‚¹å‡»æŸ¥çœ‹[å¹³é“ºçš„ç»“æ„ä¸æ˜¯ node_modules çš„å”¯ä¸€å®ç°æ–¹å¼ | pnpm](https://pnpm.io/zh/blog/2020/05/27/flat-node-modules-is-not-the-only-way)

### ä½¿ç”¨ npm å®‰è£…

> npm install -g pnpm

ä¹‹åä¾¿å¯ç”¨ pnpm ä»£æ›¿ npm å‘½ä»¤äº†ï¼Œä»¥ä¸‹æ˜¯ç®€ä¾¿çš„ npm å‘½ä»¤ç­‰æ•ˆåˆ—è¡¨ï¼Œå¯å¸®åŠ©æ‚¨å…¥é—¨ï¼š

| npm å‘½ä»¤        | pnpm ç­‰æ•ˆ        |
| :-------------- | :--------------- |
| npm install     | pnpm install     |
| npm i \<pkg\>   | pnpm add \<pkg\> |
| npm run \<cmd\> | pnpm \<cmd\>     |

### ä¸‹å›¾æ˜¯ä¸å…¶å®ƒåŒ…ç®¡ç†å™¨çš„æ¯”è¾ƒ

![img.png](images/img.png)

## pnpm Workspace

### å¦‚ä½•å¯ç”¨

ä¸€ä¸ª workspace çš„æ ¹ç›®å½•ä¸‹å¿…é¡»æœ‰ pnpm-workspace.yaml æ–‡ä»¶ï¼Œ ä¹Ÿå¯èƒ½ä¼šæœ‰ .npmrc æ–‡ä»¶ã€‚

###

pnpm-workspace.yamlç¤ºä¾‹:

```yaml
packages:
  - packages/* # packages ç›®å½•ä¸‹éƒ½æ˜¯ç»„ä»¶åŒ…
```

## Workspace åè®®

WorkSpaceåè®®æ˜¯pnpmæ”¯æŒMonorepoçš„ä¸€ä¸ªé‡è¦åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æŒ‡å®šå·¥ä½œç©ºé—´å†…çš„åŒ…ä¾èµ–å…³ç³»ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œxbuildçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```text
â”œâ”€â”€ packages
â”‚   â”œâ”€â”€ babel-preset-xbuild-app
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ shared-utils
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ swc-options
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ service
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ package.json
â””â”€â”€ pnpm-workspace.yaml
```

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œ@xm/xbuild-service åŒ…ä¾èµ–äº†@xm/babel-preset-xbuild-appã€@xm/xbuild-shared-utilsã€@xm/xbuild-swc-options è¿™ä¸‰ä¸ªåŒ…ï¼ˆè¿™
é‡ŒåŒ…åæŒ‡çš„æ˜¯package.jsonä¸­nameçš„å€¼ï¼Œä¸æ˜¯åŒ…çš„ç›®å½•åç§°ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ«åå¼•ç”¨ã€‚

æ¯”å¦‚ï¼Œåœ¨ @xm/xbuild-service åŒ…çš„ package.json æ–‡ä»¶ä¸­å£°æ˜:

```json
{
  "name": "@xm/xbuild-service",
  "version": "0.2.34",
  "dependencies": {
    "@xm/babel-preset-xbuild-app": "workspace:*",
    "@xm/xbuild-shared-utils": "workspace:*",
    "@xm/xbuild-swc-options": "workspace:~"
  }
}
```

è¿™æ ·åœ¨æ ¹ç›®å½•è¿›è¡Œ pnpm install æ—¶ï¼Œpnpmä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†åŒ…ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚

å½“æˆ‘ä»¬å‘å¸ƒ workspace åŒ…æ—¶ï¼Œpnpm ä¼šåŠ¨æ€æ›¿æ¢è¿™äº› workspace: ä¾èµ–ï¼š

- ç›®æ ‡ workspace ä¸­çš„å¯¹åº”ç‰ˆæœ¬ï¼ˆå¦‚æœä½¿ç”¨ workspace:\*, workspace:~, or workspace:^ï¼‰
- ç›¸å…³çš„ semver èŒƒå›´ï¼ˆå¯¹äºä»»ä½•å…¶ä»–èŒƒå›´ç±»å‹ï¼‰

è¿˜æ˜¯ç”¨ä¸Šé¢ä¾‹å­ä¸¾ä¾‹ï¼š

```json
{
  "dependencies": {
    "@xm/babel-preset-xbuild-app": "workspace:*",
    "@xm/xbuild-shared-utils": "workspace:*",
    "@xm/xbuild-swc-options": "workspace:~"
  }
}
```

å°†ä¼šè¢«è½¬åŒ–ä¸ºï¼š

```json
{
  "dependencies": {
    "@xm/babel-preset-xbuild-app": "0.2.12",
    "@xm/xbuild-shared-utils": "0.0.13",
    "@xm/xbuild-swc-options": "~0.2.28"
  }
}
```

è¿™é‡Œçš„ 0.2.12ã€0.0.13ã€0.2.28 æ˜¯å¯¹åº”åŒ…å…·ä½“ç‰ˆæœ¬å·ï¼Œè¿™ä¸ªåŠŸèƒ½å…è®¸ä½ å‘å¸ƒè½¬åŒ–ä¹‹åçš„åŒ…åˆ°è¿œç«¯ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸ä½¿ç”¨æœ¬åœ° workspace ä¸­çš„ packagesï¼Œè€Œ
ä¸éœ€è¦å…¶å®ƒä¸­é—´æ­¥éª¤ã€‚

åŒ…çš„ä½¿ç”¨è€…ä¹Ÿå¯ä»¥åƒå¸¸è§„çš„åŒ…é‚£æ ·æ­£å¸¸ä½¿ç”¨ï¼Œä¸”ä»ç„¶å¯ä»¥å—ç›Šäº[è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)ã€‚

## åœ¨ pnpm ä¸­ä½¿ç”¨ Changesets

### é…ç½®

è¦åœ¨ pnpm å·¥ä½œç©ºé—´ä¸Šé…ç½® changesetsï¼Œè¯·å°† changesets ä½œä¸ºå¼€å‘ä¾èµ–é¡¹å®‰è£…åœ¨å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•ä¸­ï¼š

> pnpm add -Dw @changesets/cli

-D å°†æŒ‡å®šçš„ packages å®‰è£…ä¸º devDependencies

-w åœ¨å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•ä¸­å¯åŠ¨ pnpm ï¼Œè€Œä¸æ˜¯å½“å‰çš„å·¥ä½œç›®å½•

ç„¶å changesets çš„åˆå§‹åŒ–å‘½ä»¤ï¼š

> pnpm changeset init

## å¼€å‘æ¨¡æ¿

åŸºäº dumi + father + pnpm + changesets å¤šåŒ…ç®¡ç†æ¨¡æ¿

### feature

âœ… å¤šåŒ…ç®¡ç†
âœ… å•å…ƒæµ‹è¯•
âœ… æ–‡æ¡£é˜…è¯»
âœ… eslint è§„èŒƒ
âœ… cjs + esm ç¼–è¯‘
âœ… typescript

### å¿«é€Ÿå¼€å§‹

1. åˆå§‹åŒ–é¡¹ç›®

(1) å®‰è£…pnpm

```bash
npm install -g pnpm
```

(2) æ–°å»º pnpm-changesets-template é¡¹ç›®

```bash
mkdir pnpm-changesets-template && cd pnpm-changesets-template
```

(3) åˆå§‹åŒ–package.json

```bash
pnpm init
```

(4) é…ç½® .npmrc

æ­¤å¤–ï¼Œæˆ‘ä»¬è¦é¢å¤–åˆ›å»ºpnpmçš„é…ç½®æ–‡ä»¶ï¼š.npmrcï¼Œé…ç½®å¦‚ä¸‹ï¼š

```text
shamefully-hoist=false
```

shamefully-hoistçš„å«ä¹‰ï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼Œpnpm åˆ›å»ºä¸€ä¸ªåŠä¸¥æ ¼çš„ node_modulesï¼Œè¿™æ„å‘³ç€ä¾èµ–é¡¹å¯ä»¥è®¿é—®æœªå£°æ˜çš„ä¾èµ–é¡¹ï¼Œä½† node_modules ä¹‹å¤–çš„æ¨¡å—ä¸è¡Œã€‚
é€šè¿‡è¿™ç§å¸ƒå±€ï¼Œç”Ÿæ€ç³»ç»Ÿä¸­çš„å¤§å¤šæ•°çš„åŒ…éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæŸäº›å·¥å…·ä»…åœ¨æå‡çš„ä¾èµ–é¡¹ä½äºæ ¹ç›®å½•çš„ node_modules æ—¶æ‰æœ‰æ•ˆï¼Œ
æ‚¨å¯ä»¥å°†å…¶è®¾ç½®ä¸º true æ¥ä¸ºæ‚¨æå‡å®ƒä»¬ã€‚

(6) åˆ›å»º packages ç›®å½•

```bash
mkdir packages
```

(7) åˆ›å»ºå·¥ä½œç©ºé—´
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º pnpm-workspace.yaml æ–‡ä»¶ï¼Œé‡Œé¢æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œè¿™æ ·åœ¨packagesèŒƒå›´ä¸‹çš„åŒ…éƒ½èƒ½å…±äº«å·¥ä½œç©ºé—´äº†ã€‚

```yaml
packages:
  - 'packages/*'
```

2. ç»Ÿä¸€å¼€å‘ç¯å¢ƒ

å¼€å‘ç¯å¢ƒçš„ç»Ÿä¸€ï¼Œä¸»è¦æ˜¯ç»Ÿä¸€Nodeç‰ˆæœ¬å’Œpnpmï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨package.jsonä¸­é…ç½®ä¸€äº›å­—æ®µæ¥ç»Ÿä¸€å¼€å‘ç¯å¢ƒã€‚

(1) é™åˆ¶Nodeç‰ˆæœ¬å’Œpnpm
é€šè¿‡é…ç½®voltaå’Œenginesé™åˆ¶Nodeå’Œpnpmçš„ç‰ˆæœ¬

```json
{
  "volta": {
    "node": "16.19.1"
  },
  "engines": {
    "node": "16.19.1",
    "pnpm": ">=8"
  }
}
```

(2) é™åˆ¶é¡¹ç›®åªèƒ½é€šè¿‡pnpmåˆå§‹åŒ–ä¾èµ–

```json
{
  "scripts": {
    "preinstall": "npx only-allow pnpm"
  }
}
```

å¦‚æœå¼€å‘ç¯å¢ƒä¸èƒ½æ»¡è¶³æ¡ä»¶ï¼Œä¼šæŠ¥é”™:
![img1.png](images/img1.png)

3. é›†æˆchangesets

(1) å®‰è£… @changesets/cli åŒ…

```bash
pnpm add -Dw @changesets/cli
```

(2) æ‰§è¡Œ changesets çš„åˆå§‹åŒ–å‘½ä»¤

```bash
pnpm changeset init
```

è¿™ä¸ªæ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ª .changeset ç›®å½•ï¼Œé‡Œé¢ä¼šç”Ÿæˆä¸€ä¸ª changeset çš„ config æ–‡ä»¶ï¼š

```json
{
  "$schema": "https://unpkg.com/@changesets/config@2.3.1/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "restricted",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": []
}
```

4. é›†æˆESlint

eslint æ˜¯ä¸€ä¸ªä»£ç æ£€æµ‹å·¥å…·ï¼Œç”¨äºæ£€æµ‹ä»£ç ä¸­æ½œåœ¨çš„é—®é¢˜å’Œé”™è¯¯ï¼Œä½œç”¨æé«˜ä»£ç è´¨é‡å’Œè§„èŒƒã€‚

(1) å®‰è£…eslint

```bash
pnpm i eslint -Dw
```

(2) æ‰§è¡Œå®Œæˆåï¼Œè‡ªåŠ¨ç”Ÿæˆ eslint é…ç½®æ–‡ä»¶.eslintrc.js å¯åœ¨ .eslintrc.js ä¸­é…ç½® rules å®šä¹‰æ ¡éªŒè§„åˆ™

(3) å¿«é€Ÿæ„å»º eslint é…ç½®æ–‡ä»¶

```bash
pnpm create @eslint/config
```

å‚è€ƒå¦‚ä¸‹æˆªå›¾ï¼š

![img2.png](images/img2.png)

.eslintrc.js æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```js
module.exports = {
  env: {
    browser: true,
    es2021: true
  },
  extends: 'eslint:recommended',
  overrides: [
    {
      env: {
        node: true
      },
      files: ['.eslintrc.{js,cjs}'],
      parserOptions: {
        sourceType: 'script'
      }
    }
  ],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {}
}
```

(4) æ”¯æŒTypeScript

åœ¨ TypeScript é¡¹ç›®ä¸­ä½¿ç”¨ ESLint æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ä¿æŒä»£ç çš„ä¸€è‡´æ€§å’Œè´¨é‡ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ç»“åˆ TypeScript å’Œ ESLint çš„æ­¥éª¤ï¼š

(4.1). å®‰è£…å’Œé…ç½® ESLintï¼š é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£… ESLintã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… ESLint å’Œ TypeScript è§£æå™¨ï¼š

```bash
pnpm add eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin@latest -Dw
```

(4.2). åœ¨ .eslintrc.js ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š

```js
module.exports = {
  parser: '@typescript-eslint/parser',
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: ['eslint:recommended', 'plugin:@typescript-eslint/recommended'],
  ignorePatterns: ['**/*.test.js'],
  // å…¶ä»– ESLint é…ç½®
  plugins: ['@typescript-eslint'],
  overrides: [
    {
      env: {
        node: true
      },
      files: ['.eslintrc.{js,cjs}'],
      parserOptions: {
        sourceType: 'script'
      }
    }
  ],
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  rules: {}
}
```

5. é›†æˆhusky

husky æ˜¯ä¸€ä¸ª Git é’©å­ï¼ˆGit hooksï¼‰å·¥å…·ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ Git äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œè„šæœ¬ï¼Œè¿›è¡Œä»£ç æ ¼å¼åŒ–ã€æµ‹è¯•ç­‰æ“ä½œã€‚

å¸¸è§çš„é’©å­

- pre-commitï¼šåœ¨æ‰§è¡Œ Git commit å‘½ä»¤ä¹‹å‰è§¦å‘ï¼Œç”¨äºåœ¨æäº¤ä»£ç å‰è¿›è¡Œä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€æµ‹è¯•ç­‰æ“ä½œã€‚
- commit-msgï¼šåœ¨æäº¤æ¶ˆæ¯ï¼ˆcommit messageï¼‰è¢«åˆ›å»ºåï¼Œä½†æäº¤æ“ä½œå°šæœªå®Œæˆä¹‹å‰è§¦å‘ï¼Œç”¨äºæ ¡éªŒæäº¤æ¶ˆæ¯çš„æ ¼å¼å’Œå†…å®¹ã€‚
- pre-pushï¼šåœ¨æ‰§è¡Œ Git push å‘½ä»¤ä¹‹å‰è§¦å‘ï¼Œç”¨äºåœ¨æ¨é€ä»£ç å‰è¿›è¡Œé¢å¤–æ£€æŸ¥ã€æµ‹è¯•ç­‰æ“ä½œã€‚

(1) å®‰è£…

> æ³¨æ„ï¼éœ€è¦åœ¨ .git æ–‡ä»¶åŒç›®å½•ä¸‹å®‰è£… huskyï¼Œå¦åˆ™æ— æ³•è¯†åˆ«ç¯å¢ƒå¯¼è‡´å®‰è£…å¤±è´¥ï¼

- åˆå§‹åŒ–gitä»“åº“

```bash
git init
```

(2) å¹¶åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º .gitignore æ–‡ä»¶ï¼Œå¤åˆ¶ä»¥ä¸‹æ–‡æœ¬åˆ° .gitignore æ–‡ä»¶ä¸­

```text
node_modules
dist
.idea
.vscode
*-error.log

.DS_Store
Thumbs.db
*.zip

lib
/**/.pnpm-debug.log
/.npm
```

(3) åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… huskyï¼š

```bash
pnpm i husky -Dw
```

(4) å¯ç”¨ git é’©å­ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ˆè¿™é‡Œä¸èƒ½ä½¿ç”¨ pnpm ä»£æ›¿ï¼Œä¼šæŠ¥é”™ï¼‰

```bash
npm pkg set scripts.prepare="husky install"
```

(5) å®‰è£…æˆåŠŸåä¼šåœ¨ package.json æ–‡ä»¶ä¸­ script ä¸­ç”Ÿæˆå‘½ä»¤

> æ³¨æ„ï¼å¦‚æœä¸æ˜¯å‘½ä»¤è¡Œç”Ÿæˆï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å°†å¦‚ä¸‹å†…å®¹ç²˜è´´åˆ° package.json æ–‡ä»¶ä¸­

```json
{
  "scripts": {
    "prepare": "husky install"
  }
}
```

æ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œç”Ÿæˆ .husky ç›®å½•

```bash
pnpm prepare
```

å¦‚å›¾ï¼Œæ‰§è¡ŒæˆåŠŸåï¼Œé¡¹ç›®ä¸­ç”Ÿæˆä¸€ä¸ª .husky ç›®å½•

![img3.png](images/img3.png)

(6) åˆ›å»º Git æŒ‚é’© pre-commitï¼Œåœ¨ Git æäº¤ä¹‹å‰åšeslint è¯­æ³•æ ¡éªŒ ã€‚

```bash
pnpm husky add .husky/pre-commit "npm test"
```

æ‰§è¡ŒæˆåŠŸï¼Œ.husky ç›®å½•å¤šå‡ºä¸€ä¸ª pre-commit æ–‡ä»¶

![img4.png](images/img4.png)

(7) é…ç½®ä»£ç æ£€æµ‹

git æäº¤å‰ï¼Œæ‰§è¡Œ pre-commit é’©å­è„šæœ¬ï¼Œè¿›è¡Œæ ¡éªŒä»£ç è¯­æ³•ã€æ ¼å¼ä¿®å¤ç­‰æ“ä½œã€‚

æ‰“å¼€ pre-commit æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```shell
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm test
```

ä¸‹æ–¹ä»£ç æ·»åŠ åˆ° pre-commit æ–‡ä»¶ä¸­ã€‚lint-stagedæ¨¡å—ï¼Œ ç”¨äºå¯¹ git æš‚å­˜åŒºæ£€æµ‹

```text
npx --no-install lint-staged
```

> npx --no-install lint-staged æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºåœ¨ä¸å®‰è£… lint-staged çš„æƒ…å†µä¸‹è¿è¡Œè¯¥å·¥å…·ã€‚npx --no-install å‘½ä»¤ç”¨äºä»è¿œç¨‹ä¸‹è½½å¹¶æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚

6. é›†æˆlint-staged

ä½œç”¨ï¼šlint-staged å¯ä»¥è®©ä½ åœ¨ Git æš‚å­˜ï¼ˆstagedï¼‰åŒºåŸŸä¸­çš„æ–‡ä»¶ä¸Šè¿è¡Œè„šæœ¬ï¼Œé€šå¸¸ç”¨äºåœ¨æäº¤å‰å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ã€é™æ€æ£€æŸ¥ç­‰æ“ä½œã€‚

- ä½œç”¨ï¼šlint-staged å¯ä»¥è®©ä½ åœ¨ Git æš‚å­˜ï¼ˆstagedï¼‰åŒºåŸŸä¸­çš„æ–‡ä»¶ä¸Šè¿è¡Œè„šæœ¬ï¼Œé€šå¸¸ç”¨äºåœ¨æäº¤å‰å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ã€é™æ€æ£€æŸ¥ç­‰æ“ä½œã€‚
- ä½¿ç”¨æ–¹å¼ï¼šä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ lint-staged é…åˆ husky é’©å­æ¥æ‰§è¡Œé’ˆå¯¹æš‚å­˜æ–‡ä»¶çš„è„šæœ¬ã€‚å…·ä½“çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

(1) åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… lint-stagedï¼š

```bash
pnpm i lint-staged -Dw
```

(2) åœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": ["eslint --fix"]
  }
}
```

"\*.{js,jsx,ts,tsx}" æ˜¯æŒ‡å®šè¦é’ˆå¯¹çš„æš‚å­˜æ–‡ä»¶æ¨¡å¼ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®éœ€æ±‚æ¥é…ç½®ã€‚
eslint --fix ä¸ºæ ¡éªŒå‘½ä»¤ï¼Œå¯æ‰§è¡Œ eslint ç­‰è§„åˆ™

7. é›†æˆprettier

prettier æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚prettier ä¸ä¸Šè¿° husky å’Œ lint-staged æ­é…ä½¿ç”¨ï¼Œå¯ä»¥åœ¨æäº¤ä»£ç ä¹‹å‰è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚å…·ä½“çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… prettierï¼š

```bash
pnpm i prettier -Dw
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º .prettierrc.js æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä½ æƒ³è¦çš„ä»£ç æ ·å¼ï¼Œä¾‹å¦‚ï¼š

```js
module.exports = {
  semi: false, // åœ¨è¯­å¥æœ«å°¾ï¼Œä»…åœ¨å¯èƒ½å¯¼è‡´ ASI å¤±è´¥çš„è¡Œå¼€å¤´æ·»åŠ åˆ†å·
  trailingComma: 'none', // åœ¨å¤šè¡Œé€—å·åˆ†éš”çš„è¯­æ³•ç»“æ„ä¸­, æ²¡æœ‰å°¾éšé€—å·
  arrowParens: 'avoid', // åœ¨å”¯ä¸€çš„ç®­å¤´å‡½æ•°å‚æ•°å‘¨å›´, å°½å¯èƒ½çœç•¥æ‹¬å·
  tabWidth: 2, // æŒ‡å®šæ¯ä¸ªç¼©è¿›çº§åˆ«çš„ç©ºæ ¼æ•°
  singleQuote: true, // ä½¿ç”¨å•å¼•å·è€Œä¸æ˜¯åŒå¼•å·
  printWidth: 100, // æœ€å¤§è¡Œé•¿åº¦å­—ç¬¦æ•°
  bracketSpacing: true, // å¯¹è±¡å­—é¢é‡ä¹‹é—´ä¿ç•™ç©ºæ ¼
  bracketSameLine: true // å°†å¤šè¡Œ HTMLï¼ˆHTMLã€JSXã€Vueã€Angularï¼‰å…ƒç´ çš„ > æ”¾åœ¨æœ€åä¸€è¡Œçš„æœ«å°¾ï¼Œè€Œä¸æ˜¯å•ç‹¬æ”¾åœ¨ä¸‹ä¸€è¡Œï¼ˆä¸é€‚ç”¨äºè‡ªé—­åˆå…ƒç´ ï¼‰
}
```

è¿™é‡Œçš„é…ç½®é€‰é¡¹æ ¹æ®ä½ çš„éœ€æ±‚å®šä¹‰ï¼Œå…·ä½“é€‰é¡¹å¯ä»¥å‚è€ƒ [prettier æ–‡æ¡£](https://www.prettier.cn/docs/options.html)ã€‚ åœ¨ lint-staged çš„é…
ç½®ä¸­æ·»åŠ  "prettier --write"ï¼Œä¾‹å¦‚ï¼š

```json
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": ["prettier --write", "eslint --fix"]
  }
}
```

- "prettier --write" ä¸ºæ ¡éªŒå‘½ä»¤ï¼Œå¯æ‰§è¡Œ prettier ç­‰è§„åˆ™

æ–°å»º .prettierignore æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä½ æƒ³è¦ prettier å¿½ç•¥çš„æ–‡ä»¶

```text
# Ignore artifacts:
coverage
node_modules
dist
.changeset
**/public
**/.umi
lib
```

è¿™æ ·å½“ä½ è¿›è¡Œ GIT æäº¤æ“ä½œæ—¶ï¼Œlint-staged å°†è‡ªåŠ¨è¿è¡Œ prettier æ¥æ ¼å¼åŒ–ç¬¦åˆè§„åˆ™çš„æ–‡ä»¶ã€‚

- é…ç½® ctrl + sï¼Œè‡ªåŠ¨ä¿å­˜åŠŸèƒ½

ç¬¬ä¸€ç§ï¼Œåœ¨vscodeä¸­é…ç½®ï¼šå·¦ä¸‹è§’è®¾ç½® => å·¥ä½œåŒº => æ–‡æœ¬ç¼–è¾‘å™¨

![img5.png](images/img5.png)

ç¬¬äºŒç§ï¼Œåœ¨WebStormä¸­é…ç½®ï¼šå³ä¸Šè§’è®¾ç½® => Preferences => Languages & Framework => JavaScript => Prettier

![img6.png](images/img6.png)

8. é›†æˆCommitizen

- æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä»¥ä¸€è‡´çš„æ–¹å¼ç¼–å†™è§„èŒƒçš„æäº¤æ¶ˆæ¯ã€‚åœ¨ä½¿ç”¨ Commitizen ä¹‹å‰ï¼Œä½ éœ€è¦å®‰è£… Commitizen åŠå…¶é€‚é…å™¨ã€‚

- cz-conventional-changelog æ˜¯ Commitizen çš„ä¸€ä¸ªé€‚é…å™¨ï¼Œå®ƒå®ç°äº†ç¬¦åˆçº¦å®šå¼æäº¤ï¼ˆConventional Commitsï¼‰è§„èŒƒçš„æäº¤æ¶ˆæ¯ã€‚è¯¥è§„èŒƒå®šä¹‰äº†æäº¤æ¶ˆæ¯çš„æ ¼å¼å’Œç»“æ„ï¼Œå¹¶æ¨èäº†ä¸€äº›å¸¸ç”¨çš„æäº¤ç±»å‹å’ŒèŒƒå›´

(1) å®‰è£…

```bash
pnpm add commitizen cz-conventional-changelog -Dw
```

(2) å®‰è£…å®Œæˆåï¼Œåœ¨ package.json ä¸­æ·»åŠ ä¸€ä¸ª config.commitizen çš„å­—æ®µï¼Œå¹¶è®¾ç½®å®ƒçš„å€¼ä¸º cz-conventional-changelogã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```json
{
  "config": {
    "commitizen": {
      "path": "cz-conventional-changelog"
    }
  }
}
```

(3) åœ¨ package.json ä¸­çš„ scripts å­—æ®µä¸­æ·»åŠ ä¸€ä¸ª commit çš„å‘½ä»¤ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š

```json
{
  "scripts": {
    "commit": "git-cz"
  }
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `pnpm commit` ä»£æ›¿ `git commit` å‘½ä»¤æ¥è¿›è¡Œäº¤äº’å¼æäº¤ã€‚

```bash
git add .
pnpm commit
```

![img7.png](images/img7.png)

è¯¦ç»†æ–‡æ¡£ï¼š[Git Guide
Angularæäº¤ä¿¡æ¯è§„èŒƒ](https://zj-git-guide.readthedocs.io/zh-cn/latest/message/Angular%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF%E8%A7%84%E8%8C%83/)

9. é›†æˆcommitlint

- ä½œç”¨ï¼šcommitlint ç”¨äºæ ¡éªŒ Git æäº¤ä¿¡æ¯çš„æ ¼å¼æ˜¯å¦ç¬¦åˆé¢„å®šä¹‰çš„è§„èŒƒã€‚
- ä½¿ç”¨æ–¹å¼ï¼šä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ commitlint æ¥è§„èŒƒæäº¤ä¿¡æ¯çš„æ ¼å¼ï¼Œä¾‹å¦‚ä½¿ç”¨çº¦å®šå¼æäº¤ï¼ˆConventional Commitsï¼‰çš„æ ¼å¼ã€‚å…·ä½“çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š

(1) åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… commitlint

```bash
pnpm add @commitlint/cli @commitlint/config-conventional -Dw
```

(2) åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º commitlint.config.js æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```js
module.exports = {
  extends: ['@commitlint/config-conventional']
}
```

(3) è¿™é‡Œä½¿ç”¨äº† `@commitlint/config-conventional` åŒ…æä¾›çš„é¢„å®šä¹‰é…ç½®ï¼Œå¯æ ¹æ®éœ€è¦è‡ªå®šä¹‰é…ç½®ã€‚ä½ è¿˜å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰è‡ªå·±çš„è§„åˆ™ã€‚

åœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "scripts": {
    "commitmsg": "commitlint -E HUSKY_GIT_PARAMS"
  }
}
```

(4) ä¿®æ”¹ husky çš„é…ç½®ï¼Œæ·»åŠ  "commit-msg" é’©å­äº‹ä»¶å¦‚ä¸‹ï¼š

```json
{
  "husky": {
    "hooks": {
      "commit-msg": "npm run commitmsg"
    }
  }
}
```

æˆ–è€…ä½¿ç”¨å‘½ä»¤åˆ›å»ºé’©å­è„šæœ¬æ–‡ä»¶

```bash
npx husky add .husky/commit-msg  'npx --no -- commitlint --edit ${1}'
```

æ‰§è¡ŒæˆåŠŸï¼Œ.husky ç›®å½•å¤šå‡ºä¸€ä¸ª `commit-msg` æ–‡ä»¶

![img8.png](images/img8.png)

è¿™æ ·å½“ä½ è¿›è¡Œæäº¤ä¿¡æ¯æ—¶ï¼Œcommitlint å°†è‡ªåŠ¨æ ¡éªŒæäº¤ä¿¡æ¯çš„æ ¼å¼æ˜¯å¦ç¬¦åˆé¢„å®šä¹‰è§„èŒƒï¼Œå¹¶ç»™å‡ºç›¸åº”çš„æç¤ºå’Œé”™è¯¯

![img9.png](images/img9.png)

10. é›†æˆJest

(1) å®‰è£…Jest

```bash
pnpm add Jest -Dw
```

(2) è§£å†³ `eslint` æŠ¥é”™

![img10.png](images/img10.png)

è¿™ä¸ªé—®é¢˜é€šå¸¸æ˜¯å› ä¸ºæ‚¨çš„ ESLint é…ç½®ä¸­æ²¡æœ‰åŒ…å« Jest çš„ç›¸å…³è§„åˆ™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ­¥éª¤ï¼š

(3) ä½¿ç”¨ eslint-plugin-jestï¼š æ‚¨å¯ä»¥ä½¿ç”¨ eslint-plugin-jest æ¥è§„èŒƒ Jest å•å…ƒæµ‹è¯•ä»£ç ã€‚è¿™ä¸ªæ’ä»¶æä¾›äº†ä¸€äº›æœ‰ç”¨çš„è§„åˆ™ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ç¼–å†™æ›´è§„èŒƒçš„æµ‹è¯•ä»£ç ã€‚

åœ¨æ‚¨çš„é¡¹ç›®ä¸­å®‰è£… eslint-plugin-jestï¼š

```bash
pnpm add eslint-plugin-jest -Dw
```

(4) å°† jest æ·»åŠ åˆ° .eslintrc é…ç½®æ–‡ä»¶çš„æ’ä»¶éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥çœç•¥ eslint-plugin- å‰ç¼€ï¼š

```json
{
  "plugins": ["jest"]
}
```

(5) ç„¶ååœ¨è§„åˆ™éƒ¨åˆ†é…ç½®æ‚¨è¦ä½¿ç”¨çš„è§„åˆ™ã€‚

```json
{
  "rules": {
    "jest/no-disabled-tests": "warn",
    "jest/no-focused-tests": "error",
    "jest/no-identical-title": "error",
    "jest/prefer-to-have-length": "warn",
    "jest/valid-expect": "error"
  }
}
```

å‚è€ƒæ–‡æ¡£ï¼š[eslint-plugin-jest](https://github.com/jest-community/eslint-plugin-jest)

11. é›†æˆfather

father æ˜¯ä¸€æ¬¾ NPM åŒ…ç ”å‘å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆã€é«˜è´¨é‡åœ°ç ”å‘ NPM åŒ…ã€ç”Ÿæˆæ„å»ºäº§ç‰©ã€å†å®Œæˆå‘å¸ƒã€‚

æ ¹æ®å®˜ç½‘ä»‹ç»ï¼Œå®ƒæä¾›äº†å¦‚ä¸‹ç‰¹æ€§ï¼š

- âš”ï¸ åŒæ¨¡å¼æ„å»ºï¼š æ”¯æŒ Bundless åŠ Bundle ä¸¤ç§æ„å»ºæ¨¡å¼ï¼ŒESModule åŠ CommonJS äº§ç‰©ä½¿ç”¨ Bundless æ¨¡å¼ï¼ŒUMD äº§ç‰©ä½¿ç”¨ Bundle æ¨¡å¼
- ğŸ› å¤šæ„å»ºæ ¸å¿ƒï¼š Bundle æ¨¡å¼ä½¿ç”¨ Webpack ä½œä¸ºæ„å»ºæ ¸å¿ƒï¼ŒBundless æ¨¡å¼æ”¯æŒ esbuildã€Babel åŠ SWC ä¸‰ç§æ„å»ºæ ¸å¿ƒï¼Œå¯é€šè¿‡é…ç½®è‡ªç”±åˆ‡æ¢
- ğŸ”– ç±»å‹ç”Ÿæˆï¼š æ— è®ºæ˜¯æºç æ„å»ºè¿˜æ˜¯ä¾èµ–é¢„æ‰“åŒ…ï¼Œéƒ½æ”¯æŒä¸º TypeScript æ¨¡å—ç”Ÿæˆ .d.ts ç±»å‹å®šä¹‰
- ğŸš€ æŒä¹…ç¼“å­˜ï¼š æ‰€æœ‰äº§ç‰©ç±»å‹å‡æ”¯æŒæŒä¹…ç¼“å­˜ï¼ŒäºŒæ¬¡æ„å»ºæˆ–å¢é‡æ„å»ºåªéœ€ã€å—–ã€çš„ä¸€ä¸‹
- ğŸ©º é¡¹ç›®ä½“æ£€ï¼š å¯¹ NPM åŒ…ç ”å‘å¸¸è§è¯¯åŒºåšæ£€æŸ¥ï¼Œè®©æ¯ä¸€æ¬¡å‘å¸ƒéƒ½æ›´åŠ ç¨³å¥
- ğŸ— å¾®ç”Ÿæˆå™¨ï¼š ä¸ºé¡¹ç›®è¿½åŠ ç”Ÿæˆå¸¸è§çš„å·¥ç¨‹åŒ–èƒ½åŠ›ï¼Œä¾‹å¦‚ä½¿ç”¨ jest ç¼–å†™æµ‹è¯•
- ğŸ“¦ ä¾èµ–é¢„æ‰“åŒ…ï¼š å¼€ç®±å³ç”¨çš„ä¾èµ–é¢„æ‰“åŒ…èƒ½åŠ›ï¼Œå¸®åŠ© Node.js æ¡†æ¶/åº“æå‡ç¨³å®šæ€§ã€ä¸å—ä¸Šæ¸¸ä¾èµ–æ›´æ–°å½±å“ï¼ˆå®éªŒæ€§ï¼‰

(1) å®‰è£…

```bash
pnpm add father -Dw
```

(2) æ·»åŠ  .fatherrc.js é…ç½®æ–‡ä»¶ï¼š

```js
export default {
  // ä»¥ä¸‹ä¸º esm é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  esm: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'browser', // é»˜è®¤æ„å»ºä¸º Browser ç¯å¢ƒçš„äº§ç‰©
    transformer: 'babel' // é»˜è®¤ä½¿ç”¨ babel ä»¥æä¾›æ›´å¥½çš„å…¼å®¹æ€§
  },
  cjs: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'node', // é»˜è®¤æ„å»ºä¸º Node.js ç¯å¢ƒçš„äº§ç‰©
    transformer: 'esbuild' // é»˜è®¤ä½¿ç”¨ esbuild ä»¥è·å¾—æ›´å¿«çš„æ„å»ºé€Ÿåº¦
  }
}
```

é»˜è®¤ä¼šåœ¨ .fatherrc.js æ‰€åœ¨çš„åŒçº§ç›®å½•ä¸‹ç”Ÿæˆ dist ç›®å½•ï¼Œå…¶ä¸­cjsç›®å½•ä¸‹çš„æ–‡ä»¶ä¸º CommonJS äº§ç‰©ï¼Œesmç›®å½•ä¸‹çš„æ–‡ä»¶ä¸º ESModule äº§ç‰©ã€‚

12. é›†æˆdumi

dumiï¼Œæ˜¯ä¸€æ¬¾ä¸ºç»„ä»¶å¼€å‘åœºæ™¯è€Œç”Ÿçš„é™æ€ç«™ç‚¹æ¡†æ¶ã€‚

æ ¹æ®å®˜ç½‘ä»‹ç»ï¼Œå®ƒæä¾›äº†å¦‚ä¸‹ç‰¹æ€§ï¼š

- ğŸš€ æ›´å¥½çš„ç¼–è¯‘æ€§èƒ½ï¼šé€šè¿‡ç»“åˆä½¿ç”¨ Umi 4 MFSUã€esbuildã€SWCã€æŒä¹…ç¼“å­˜ç­‰æ–¹æ¡ˆï¼Œå¸¦æ¥æ¯” dumi 1.x æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦
- ğŸ” å†…ç½®å…¨æ–‡æœç´¢ï¼šä¸éœ€è¦æ¥å…¥ä»»ä½•ä¸‰æ–¹æœåŠ¡ï¼Œæ ‡é¢˜ã€æ­£æ–‡ã€demo ç­‰å†…å®¹å‡å¯è¢«æœç´¢ï¼Œæ”¯æŒå¤šå…³é”®è¯æœç´¢ï¼Œä¸”ä¸ä¼šå¸¦æ¥äº§ç‰©ä½“ç§¯çš„å¢åŠ 
- ğŸ¨ å…¨æ–°ä¸»é¢˜ç³»ç»Ÿï¼šä¸ºä¸»é¢˜åŒ…å¢åŠ æ’ä»¶ã€å›½é™…åŒ–ç­‰èƒ½åŠ›çš„æ”¯æŒï¼Œä¸”å‚è€ƒ Docusaurus ä¸ºä¸»é¢˜ç”¨æˆ·æä¾›å±€éƒ¨è¦†ç›–èƒ½åŠ›ï¼Œæ›´å¼ºæ›´æ˜“ç”¨
- ğŸš¥ çº¦å®šå¼è·¯ç”±å¢å¼ºï¼šé€šè¿‡æ‹†åˆ†è·¯ç”±æ¦‚å¿µã€ç®€åŒ–è·¯ç”±é…ç½®ç­‰æ–¹å¼ï¼Œè®©è·¯ç”±ç”Ÿæˆä¸€æ”¹ dumi 1.x çš„æ€ªå¼‚ã€ç¹çï¼Œæ›´åŠ ç¬¦åˆç›´è§‰
- ğŸ’¡ èµ„äº§å…ƒæ•°æ® 2.0ï¼šåœ¨ 1.x åŠ JSON Schema çš„åŸºç¡€ä¸Šå¯¹èµ„äº§å±æ€§å®šä¹‰ç»“æ„è¿›è¡Œå…¨æ–°è®¾è®¡ï¼Œä¸ºèµ„äº§çš„æµé€šæä¾›æ›´å¤šå¯èƒ½
- ğŸ’ ç»§ç»­ä¸ºç»„ä»¶ç ”å‘è€Œç”Ÿï¼šæä¾›ä¸å…¨æ–°çš„ NPM åŒ…ç ”å‘å·¥å…· father 4 é›†æˆçš„è„šæ‰‹æ¶ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ç«™å¼çš„ç ”å‘ä½“éªŒ

(1) å®‰è£…

```bash
pnpm i dumi cross-env -Dw
```

(2) å¢åŠ å¯åŠ¨å‘½ä»¤ï¼Œä¿®æ”¹ package.jsonã€‚

```json
{
  "scripts": {
    "dumi": "cross-env APP_ROOT=dumi dumi dev",
    "dumi-build": "cross-env APP_ROOT=dumi dumi build"
  }
}
```

(3) å¢åŠ é…ç½®ï¼Œæ–°å»º .dumirc.jsã€‚

```js
export default {
  chainWebpack(memo) {
    memo.plugins.delete('copy')
  }
}
```

(4) æ–°å»ºæ–‡æ¡£ç›®å½• dumi/docs/ï¼Œè¿™é‡Œçš„ dumi ç›®å½•å³ç¬¬äºŒæ­¥ä¸­é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥éšæ„åŒæ­¥ä¿®æ”¹ã€‚

(5) æ–°å»ºæ–‡æ¡£ dumi/docs/index.mdã€‚

```markdown
# è¿™æ˜¯ä¸€ä¸ª dumi ç»“åˆè‡ªå·±é¡¹ç›®çš„demo
```

(6) å°† dumi çš„ä¸´æ—¶æ–‡ä»¶æ·»åŠ åˆ° .gitignore ä¸­ã€‚

```text
.dumi/tmp*
```

ç°åœ¨ä½ å¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤çœ‹æ•ˆæœäº†

```text
pnpm dumi-build
pnpm dumi
```

é¡ºåˆ©çš„è¯ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªnodeæœ¬åœ°æœåŠ¡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°±é›†æˆäº†dumiçš„æ–‡æ¡£èƒ½åŠ›ã€‚

## å¸¸è§æŠ¥é”™

å½“åœ¨æ‰§è¡Œ pnpm lint-staged å‘½ä»¤æ—¶ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼ŒåŸå› æ˜¯nodeç‰ˆæœ¬å¤ªä½ï¼Œä¸æ”¯æŒ??= çš„è¯­æ³•ï¼Œåˆ‡èŠ±åˆ°é«˜ç‰ˆæœ¬nodeï¼Œé‡æ–°å®‰è£…ä¾èµ–å°±å¯ä»¥äº†ã€‚

![img11.png](images/img11.png)

## æ€»ç»“

## å‚è€ƒæ–‡ç« 

- [pnpmå®˜ç½‘åœ°å€](https://pnpm.io/zh/)
- [ç²¾è¯»ã€Špnpmã€‹](https://zhuanlan.zhihu.com/p/553804414)
- [eslintä¸­æ–‡ç½‘](https://zh-hans.eslint.org/)
- [Prettierä¸­æ–‡ç½‘](https://www.prettier.cn/)
- [conventional-changelogå®˜ç½‘åœ°å€](https://commitlint.js.org/#/)
- [fatherå®˜ç½‘åœ°å€](https://github.com/umijs/father)
